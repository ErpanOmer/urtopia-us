{% comment %}
  Renders the collection filters component

  Usage:
  {% render 'collection-filters' %}
{% endcomment %}

<style>
  body .my-button {
    transition: none;
  }
  /* Filters Component Styles - Using 1rem = 10px base */
  .filters {
    font-size: 1.4rem; /* 14px */
  }

  /* Filter Header */
  .filters__header {
    padding: 2rem 0 1.6rem;
    border-bottom: 1px solid #ebedf0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    background: #fff;
    z-index: 1;
    flex-wrap: wrap;
    font-size: 15px;
    font-weight: 700;
  }

  .filters__results-count {
    color: #242729;
  }

  .filters__results-count .highlight {
    color: #fd4b17;
  }

  .filters__clear-link {
    font-size: 1.4rem; /* 14px */
    color: #fd4b17;
    text-decoration: none;
    cursor: pointer;
    transition: opacity 0.2s;
    text-decoration: underline;
  }

  .filters__clear-link:hover {
    opacity: 0.7;
  }

  /* Filter Section */
  .filters__section {
    border-bottom: 1px solid #ebedf0;
  }

  .filters__section-header {
    padding: 1.6rem 0;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .filters__section-title {
    font-size: 1.4rem; /* 12px */
    font-weight: 700;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: #242729;
  }

  .filters__section-arrow {
    width: 1rem;
    height: 1rem;
    transition: transform 0.3s ease;
  }

  .filters__section.is-collapsed .filters__section-arrow {
    transform: rotate(180deg);
  }

  .filters__section-content {
    padding-bottom: 2rem;
  }

  /* Filter Options List */
  .filters__options-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 1.2rem; /* 12px */
  }

  /* Radio Option (Collections) */
  .filters__radio-option {
    display: flex;
    align-items: center;
    gap: 1rem; /* 10px */
    cursor: pointer;
    position: relative;
  }

  .filters__radio-option input[type='radio'] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .filters__radio-circle {
    width: 1.4rem; /* 14px */
    height: 1.4rem; /* 14px */
    border: 1.5px solid #a0a1a2;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: border-color 0.2s;
  }

  .filters__radio-circle-inner {
    width: 0.8rem; /* 8px */
    height: 0.8rem; /* 8px */
    background-color: #242729;
    border-radius: 50%;
    opacity: 0;
    transform: scale(0);
    transition: opacity 0.2s, transform 0.2s;
  }

  .filters__radio-option input[type='radio']:checked + .filters__radio-circle {
    border-color: #242729;
  }

  .filters__radio-option input[type='radio']:checked + .filters__radio-circle .filters__radio-circle-inner {
    opacity: 1;
    transform: scale(1);
  }

  .filters__option-label {
    font-size: 1.4rem; /* 14px */
    color: #242729;
    line-height: 1.4;
  }

  /* Checkbox Option (Price, Range, Max Speed) */
  .filters__checkbox-option {
    display: flex;
    align-items: center;
    gap: 1rem; /* 10px */
    cursor: pointer;
    position: relative;
  }

  .filters__checkbox-option input[type='checkbox'] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .filters__checkbox-box {
    width: 1.6rem; /* 16px */
    height: 1.6rem; /* 16px */
    border: 1.5px solid #a0a1a2;
    border-radius: 0.3rem; /* 3px */
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: background-color 0.2s, border-color 0.2s;
  }

  .filters__checkbox-check {
    opacity: 0;
    transform: scale(0);
    transition: opacity 0.2s, transform 0.2s;
  }

  .filters__checkbox-option input[type='checkbox']:checked + .filters__checkbox-box {
    background-color: #000;
    border-color: #000;
  }

  .filters__checkbox-option input[type='checkbox']:checked + .filters__checkbox-box .filters__checkbox-check {
    opacity: 1;
    transform: scale(1);
  }

  .filters__option-label {
    font-size: 1.4rem; /* 14px */
  }

  .sort-by-select {
    appearance: none;
    -webkit-appearance: none;
    padding: 8px 32px 8px 12px;
    border: 1px solid #d8d8d8;
    border-radius: 6px;
    background-color: #fff;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    font-size: 14px;
    outline: none;
    cursor: pointer;
    font-weight: 500;
    color: #242729;
    min-width: 160px;
    transition: all 0.2s;
  }

  .sort-by-select:hover {
    border-color: #999;
    background-color: #fafafa;
  }

  .sort-by-select:focus {
    border-color: #242729;
  }
</style>
<style>
  .ebike-products {
    padding: 0;
  }

  /* 防闪烁：产品卡片初始隐藏，JS 过滤完成后显示 */
  [data-product-tags] {
    opacity: 0;
    transform: translateY(10px) scale(0.98);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .products-filtered [data-product-tags] {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  /* 过滤时隐藏的产品卡片 */
  .products-filtered [data-product-tags].is-hidden {
    opacity: 0;
    transform: translateY(10px) scale(0.98);
    pointer-events: none;
    position: absolute;
    visibility: hidden;
  }

  /* 桌面端隐藏触发按钮和遮罩 */
  .filters-mobile-trigger,
  .filters-overlay {
    display: none;
  }

  /* Filters container 桌面端样式 */
  .filters-container {
    padding: 0 2rem 2rem;
    background-color: #fff;
    border-radius: 7px;
    max-width: 300px;
    min-width: 240px;
    height: calc(100vh - 110px);
    max-height: calc(100vh - 110px);
    position: sticky;
    top: 80px;
    overflow: auto;
  }

  @media (max-width: 1310px) {
    .ebike-products .product-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 767px) {
    .ebike-products .product-grid {
      grid-template-columns: 1fr;
    }
  }

  /* 移动端样式 */
  @media (max-width: 1024px) {
    .ebike-products {
      width: 100%;
    }

    .filters__header {
      padding-top: 10px;
      top: 32px;
    }
    /* 移动端触发按钮 */
    .filters-mobile-trigger {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      padding: 0.7rem 1.5rem;
      background: #000;
      border: 1px solid #ebedf0;
      border-radius: 7.5px;
      font-size: 1.4rem;
      font-weight: 500;
      color: #fff;
      cursor: pointer;
    }

    .filters-mobile-trigger svg {
      width: 1.8rem;
      height: 1.8rem;
    }

    .filters-mobile-trigger .filter-count {
      background: #fff;
      color: #000;
      padding: 0.2rem 0.6rem;
      border-radius: 1rem;
      font-size: 1.2rem;
      min-width: 2rem;
      text-align: center;
    }

    /* 遮罩层 */
    .filters-overlay {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9998;
      opacity: 0;
      visibility: hidden;
    }

    .filters-overlay.is-initialized {
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .filters-overlay.is-visible {
      opacity: 1;
      visibility: visible;
    }

    /* Filters 变成抽屉 */
    .filters-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 85%;
      max-width: 320px;
      height: 100%;
      max-height: 100%;
      border-radius: 0;
      z-index: 9999;
      transform: translateX(-100%);
      max-width: 80vw;
    }

    .filters-container.is-initialized {
      transition: transform 0.3s ease;
    }

    .filters-container.is-open {
      transform: translateX(0);
    }

    /* 抽屉关闭按钮 */
    .filters-drawer-close {
      display: flex;
      position: absolute;
      top: 1.6rem;
      right: 1.6rem;
      width: 3.2rem;
      height: 3.2rem;
      border: none;
      background: none;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      z-index: 10;
      position: sticky;
      top: 0;
      width: 100%;
      justify-content: flex-end;
      padding-top: 15px;
      background-color: #fff;
      padding-right: 0;
    }

    .filters-drawer-close svg {
      width: 2.5rem;
      height: 2.5rem;
    }

    /* 移动端过滤器栏 */
    .filters-mobile-bar {
      display: flex;
      flex-direction: column;
      width: 100%;
      margin: 1rem 0;
    }

    .filters-mobile-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      margin-top: 1rem;
      font-size: 1.4rem;
      color: #a0a1a2;
      font-weight: 700;
    }

    .filters-mobile-results {
      font-size: 1.4rem;
      color: #666;
      font-weight: 700;
    }

    .filters-mobile-results .highlight {
      color: #fd4b17;
      font-weight: 600;
    }

    .filters-mobile-clear {
      font-size: 1.4rem;
      color: #fd4b17;
      text-decoration: none;
      cursor: pointer;
      text-decoration: underline;
    }

    .filters-mobile-clear:hover {
      text-decoration: underline;
    }
  }

  /* 桌面端隐藏移动端元素 */
  @media (min-width: 1025px) {
    .filters-drawer-close,
    .filters-mobile-bar {
      display: none;
    }
  }
</style>

<div class="filters__header">
  <span class="filters__results-count">
    <span class="highlight js-results-shown er-font-bold">0</span> OF <span class="js-results-total">1</span> RESULTS
  </span>
  <a href="#" class="filters__clear-link js-clear-filters">Clear filters (<span class="js-active-count">1</span>)</a>
</div>

<!-- Model Section -->
<div class="filters__section" data-filter-section="model">
  <div class="filters__section-header">
    <span class="filters__section-title">Model</span>
    <svg class="filters__section-arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1 1L5 5L9 1" stroke="#242729" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="filters__section-content">
    <ul class="filters__options-list">
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="model" value="all" checked>
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">All</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="model" value="carbon-series">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Carbon Series</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="model" value="carbon-joy">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Carbon Joy</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="model" value="carbon-fold-series">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Carbon Fold Series</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="model" value="carbon-st">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Carbon ST</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="model" value="carbon-fusion">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Carbon Fusion</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="model" value="smart-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Smart E-bikes</span>
        </label>
      </li>
    </ul>
  </div>
</div>

<!-- Category Section -->
<div class="filters__section" data-filter-section="category">
  <div class="filters__section-header">
    <span class="filters__section-title">Category</span>
    <svg class="filters__section-arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1 1L5 5L9 1" stroke="#242729" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="filters__section-content">
    <ul class="filters__options-list">
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="all" checked>
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">All</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="lightweight-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Lightweight Ebikes</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="commuter-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Commuter Ebikes</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="cruiser-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Cruiser Ebikes</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="step-through-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Step-Through Ebikes</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="folding-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Folding Ebikes</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="fat-tire-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Fat Tire Ebikes</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="utility-cargo-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Utility&Cargo Ebikes</span>
        </label>
      </li>
      <li>
        <label class="filters__radio-option">
          <input type="radio" name="category" value="off-road-ebikes">
          <span class="filters__radio-circle">
            <span class="filters__radio-circle-inner"></span>
          </span>
          <span class="filters__option-label">Off Road Ebikes</span>
        </label>
      </li>
    </ul>
  </div>
</div>

<!-- PRICE Section -->
<div class="filters__section" data-filter-section="price">
  <div class="filters__section-header">
    <span class="filters__section-title">PRICE</span>
    <svg class="filters__section-arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1 1L5 5L9 1" stroke="#242729" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="filters__section-content">
    <ul class="filters__options-list">
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="price" value="price-1500-2000">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">$1,500 to $2,000<span class="filters__option-count">(0)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="price" value="price-2000-2500">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">$2,000 to $2,500 <span class="filters__option-count">(0)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="price" value="over-2500">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">Over $2,500 <span class="filters__option-count">(1)</span></span>
        </label>
      </li>
    </ul>
  </div>
</div>

<!-- RANGE Section -->
<div class="filters__section" data-filter-section="range">
  <div class="filters__section-header">
    <span class="filters__section-title">RANGE</span>
    <svg class="filters__section-arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1 1L5 5L9 1" stroke="#242729" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="filters__section-content">
    <ul class="filters__options-list">
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="range" value="range-40-49">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">40 miles - 49 miles <span class="filters__option-count">(1)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="range" value="range-50-59">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">50 miles - 59 miles <span class="filters__option-count">(1)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="range" value="range-60-69">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">60 miles - 69 miles <span class="filters__option-count">(0)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="range" value="range-70-79">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">70 miles - 79 miles <span class="filters__option-count">(6)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="range" value="range-80-89">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">80 miles - 89 miles <span class="filters__option-count">(2)</span></span>
        </label>
      </li>
    </ul>
  </div>
</div>

<!-- WEIGHT Section -->
<div class="filters__section" data-filter-section="weight">
  <div class="filters__section-header">
    <span class="filters__section-title">WEIGHT</span>
    <svg class="filters__section-arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1 1L5 5L9 1" stroke="#242729" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="filters__section-content">
    <ul class="filters__options-list">
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="weight" value="weight-under-30">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">Under 30 lbs <span class="filters__option-count">(1)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="weight" value="weight-30-40">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">30 lbs - 40 lbs <span class="filters__option-count">(6)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="weight" value="weight-40-50">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">40 lbs - 50 lbs <span class="filters__option-count">(4)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="weight" value="weight-over-50">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">Over 50 lbs <span class="filters__option-count">(0)</span></span>
        </label>
      </li>
    </ul>
  </div>
</div>

<!-- THROTTLE INCLUDED Section -->
<div class="filters__section" data-filter-section="throttle">
  <div class="filters__section-header">
    <span class="filters__section-title">THROTTLE INCLUDED</span>
    <svg class="filters__section-arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1 1L5 5L9 1" stroke="#242729" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
  <div class="filters__section-content">
    <ul class="filters__options-list">
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="throttle" value="throttle-yes">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label">Includes throttle <span class="filters__option-count">(7)</span></span>
        </label>
      </li>
      <li>
        <label class="filters__checkbox-option">
          <input type="checkbox" name="throttle" value="throttle-no">
          <span class="filters__checkbox-box">
            <svg
              class="filters__checkbox-check"
              width="10"
              height="8"
              viewBox="0 0 10 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M1 4L3.5 6.5L9 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="filters__option-label"
            >Does not include throttle <span class="filters__option-count">(3)</span></span
          >
        </label>
      </li>
    </ul>
  </div>
</div>
<script type="module">
  // 移动端抽屉控制
  $(function () {
    // 防止重复注册监听器
    if (window._filtersDrawerInitialized) return;
    window._filtersDrawerInitialized = true;

    console.log('mobile drawer control');
    var $container = $('.filters-container');
    var $trigger = $('.filters-mobile-trigger');
    var $overlay = $('.filters-overlay');
    var $close = $('.filters-drawer-close');

    function openDrawer() {
      $container.addClass('is-open');
      $overlay.addClass('is-visible');
      $('body').css('overflow', 'hidden');
    }

    function closeDrawer() {
      $container.removeClass('is-open');
      $overlay.removeClass('is-visible');
      $('body').css('overflow', '');
    }

    // 更新移动端按钮上的过滤器数量
    function updateMobileFilterCount() {
      var count = $container.find('input[type="checkbox"]:checked').length;
      $container.find('input[type="radio"]:checked').each(function () {
        if ($(this).val() !== 'all') count++;
      });
      $trigger
        .find('.filter-count')
        .text(count)
        .toggle(count > 0);
    }

    $trigger.on('click', openDrawer);
    $overlay.on('click', closeDrawer);
    $close.on('click', closeDrawer);

    // 监听过滤器变化事件（先移除再添加，防止重复）
    $(document)
      .off('filters:changed.drawer filters:cleared.drawer')
      .on('filters:changed.drawer filters:cleared.drawer', updateMobileFilterCount);

    // 页面初始化时更新一次，并添加动画类（防止加载时闪烁）
    setTimeout(function () {
      updateMobileFilterCount();
      $container.addClass('is-initialized');
      $overlay.addClass('is-initialized');
    }, 100);
  });
</script>
<script type="module">
  // 防止重复初始化
  if (window._collectionFiltersInitialized) {
    console.log('collection-filters already initialized, skipping');
  } else {
    window._collectionFiltersInitialized = true;

    var $filters = $('.filters');
    var $products = $('[data-product-tags]');

    // 获取 URL 查询参数
    function getUrlParams() {
      var params = {};
      var search = window.location.search.substring(1);
      if (search) {
        search.split('&').forEach(function (pair) {
          var parts = pair.split('=');
          params[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1] || '');
        });
      }
      return params;
    }

    // 初始化：检查 URL 参数并设置默认选中状态
    function initFilters() {
      var params = getUrlParams();

      // category 和 model 是互斥的，不会同时存在于 URL 参数中
      // 默认都选中 "All"
      $filters.find('[data-filter-section="category"] input[value="all"]').prop('checked', true);
      $filters.find('[data-filter-section="model"] input[value="all"]').prop('checked', true);

      // 处理 category 参数（如果有，则覆盖默认值）
      if (params.category && params.category !== 'all') {
        var $categoryRadio = $filters.find('[data-filter-section="category"] input[value="' + params.category + '"]');
        if ($categoryRadio.length) {
          $categoryRadio.prop('checked', true);
        }
        // model 保持 all（已在上面设置）
      }

      // 处理 model 参数（如果有，则覆盖默认值）
      if (params.model && params.model !== 'all') {
        var $modelRadio = $filters.find('[data-filter-section="model"] input[value="' + params.model + '"]');
        if ($modelRadio.length) {
          $modelRadio.prop('checked', true);
        }
        // category 保持 all（已在上面设置）
      }

      // 执行一次过滤
      filterProducts();
      updateCount();
    }

    // 获取当前选中的过滤条件
    function getSelectedFilters() {
      var filters = {
        category: null,
        model: null,
        checkboxes: [],
      };

      // 获取单选的 category
      var $categoryChecked = $filters.find('[data-filter-section="category"] input[type="radio"]:checked');
      if ($categoryChecked.length && $categoryChecked.val() !== 'all') {
        filters.category = $categoryChecked.val();
      }

      // 获取单选的 model
      var $modelChecked = $filters.find('[data-filter-section="model"] input[type="radio"]:checked');
      if ($modelChecked.length && $modelChecked.val() !== 'all') {
        filters.model = $modelChecked.val();
      }

      // 获取多选的 checkbox 值
      $filters.find('input[type="checkbox"]:checked').each(function () {
        filters.checkboxes.push($(this).val());
      });

      return filters;
    }

    // 过滤产品
    function filterProducts() {
      var filters = getSelectedFilters();
      var visibleCount = 0;
      var totalCount = $products.length;

      $products.each(function () {
        var $product = $(this);
        var tags = ($product.attr('data-product-tags') || '').split(',').map(function (t) {
          return t.trim();
        });

        var showProduct = true;

        // 检查 category（单选）
        if (filters.category) {
          if (tags.indexOf(filters.category) === -1) {
            showProduct = false;
          }
        }

        // 检查 model（单选）
        if (showProduct && filters.model) {
          if (tags.indexOf(filters.model) === -1) {
            showProduct = false;
          }
        }

        // 检查 checkboxes（多选 - 任意匹配）
        // 按类型分组：price, range, weight, throttle
        if (showProduct && filters.checkboxes.length > 0) {
          var filterGroups = {};

          filters.checkboxes.forEach(function (value) {
            var type = '';
            if (value.indexOf('price') === 0 || value.indexOf('over-') === 0) {
              type = 'price';
            } else if (value.indexOf('range') === 0) {
              type = 'range';
            } else if (value.indexOf('weight') === 0) {
              type = 'weight';
            } else if (value.indexOf('throttle') === 0) {
              type = 'throttle';
            }

            if (type) {
              if (!filterGroups[type]) filterGroups[type] = [];
              filterGroups[type].push(value);
            }
          });

          // 每个分组内是"或"的关系，分组之间是"且"的关系
          for (var groupType in filterGroups) {
            var groupValues = filterGroups[groupType];
            var hasMatch = false;

            for (var i = 0; i < groupValues.length; i++) {
              if (tags.indexOf(groupValues[i]) !== -1) {
                hasMatch = true;
                break;
              }
            }

            if (!hasMatch) {
              showProduct = false;
              break;
            }
          }
        }

        // 显示/隐藏产品（使用 class 切换实现动画）
        if (showProduct) {
          $product.removeClass('is-hidden');
          visibleCount++;
        } else {
          $product.addClass('is-hidden');
        }
      });

      // 更新结果计数（桌面端和移动端）
      $filters.find('.js-results-shown').text(visibleCount);
      $filters.find('.js-results-total').text(totalCount);
      $('.js-mobile-results-shown').text(visibleCount);
      $('.js-mobile-results-total').text(totalCount);

      // 更新各个过滤选项的计数
      updateFilterCounts();

      // 标记过滤完成，显示产品（防闪烁）
      $('body').addClass('products-filtered');
    }

    // 更新各过滤选项的数量统计（优化版本）
    function updateFilterCounts() {
      var filters = getSelectedFilters();

      // 预先构建产品标签映射，避免重复解析
      var baseProductTags = [];
      $products.each(function () {
        var tags = ($(this).attr('data-product-tags') || '').split(',').map(function (t) {
          return t.trim();
        });

        // 检查是否符合 category 和 model 条件
        var matchesBase = true;
        if (filters.category && tags.indexOf(filters.category) === -1) {
          matchesBase = false;
        }
        if (matchesBase && filters.model && tags.indexOf(filters.model) === -1) {
          matchesBase = false;
        }

        if (matchesBase) {
          baseProductTags.push(tags);
        }
      });

      // 统计每个 checkbox 值的匹配数量
      var valueCounts = {};
      $filters.find('input[type="checkbox"]').each(function () {
        valueCounts[$(this).val()] = 0;
      });

      // 一次遍历计算所有值的数量
      baseProductTags.forEach(function (tags) {
        for (var value in valueCounts) {
          if (tags.indexOf(value) !== -1) {
            valueCounts[value]++;
          }
        }
      });

      // 更新 DOM
      $filters.find('input[type="checkbox"]').each(function () {
        var $countEl = $(this).closest('label').find('.filters__option-count');
        if ($countEl.length) {
          $countEl.text('(' + valueCounts[$(this).val()] + ')');
        }
      });
    }

    // 手风琴展开/收缩
    $filters.on('click', '.filters__section-header', function () {
      $(this)
        .closest('.filters__section')
        .toggleClass('is-collapsed')
        .find('.filters__section-content')
        .slideToggle(200);
    });

    // 更新 URL 查询参数
    function updateUrl() {
      var filters = getSelectedFilters();
      var params = new URLSearchParams(window.location.search);

      // 清除旧的 category 和 model 参数
      params.delete('category');
      params.delete('model');

      // 只有不是 "all" 时才添加到 URL
      if (filters.category) {
        params.set('category', filters.category);
      }
      if (filters.model) {
        params.set('model', filters.model);
      }

      // 更新 URL（不刷新页面）
      var newUrl = window.location.pathname;
      if (params.toString()) {
        newUrl += '?' + params.toString();
      }
      window.history.replaceState({}, '', newUrl);
    }

    // 平滑滚动到过滤器区域
    function scrollToSection() {
      var $section = global_config.is_mobile ? $('.filters-mobile-bar') : $('.sorting');
      if ($section.length) {
        $('html, body').animate(
          {
            scrollTop: $section.offset().top + (global_config.is_mobile ? -80 : -90),
          },
          200
        );
      }
    }

    // 排序功能
    var $productGrid = $('.product-grid');
    var $originalProducts = $products.toArray(); // 保存初始顺序

    function sortProducts(sortType) {
      var $currentProducts = $products.toArray();

      if (sortType === 'default') {
        $.each($originalProducts, function (i, el) {
          $productGrid.append(el);
        });
      } else {
        $currentProducts.sort(function (a, b) {
          var priceA = parseFloat($(a).attr('data-product-price')) || 0;
          var priceB = parseFloat($(b).attr('data-product-price')) || 0;

          if (sortType === 'price-ascending') {
            return priceA - priceB;
          } else if (sortType === 'price-descending') {
            return priceB - priceA;
          }
          return 0;
        });

        $.each($currentProducts, function (i, el) {
          $productGrid.append(el);
        });
      }
    }

    // 监听排序变化 (Desktop & Mobile)
    var $sortSelects = $('#sort-by, #sort-by-mobile');

    $sortSelects.on('change', function () {
      var val = $(this).val();
      // 同步两个下拉框的值
      $sortSelects.val(val);
      sortProducts(val);
    });

    // 过滤器变化
    $filters.on('change', 'input[type="checkbox"], input[type="radio"]', function () {
      var inputName = $(this).attr('name');
      var inputValue = $(this).val();

      // 互斥逻辑：Category 和 Model 不能同时选中非 all 的值
      if (inputName === 'model' && inputValue !== 'all') {
        // 如果选了 Model 且不是 all，重置 Category 为 all
        $('input[name="category"][value="all"]').prop('checked', true);
      } else if (inputName === 'category' && inputValue !== 'all') {
        // 如果选了 Category 且不是 all，重置 Model 为 all
        $('input[name="model"][value="all"]').prop('checked', true);
      }

      filterProducts();
      updateCount();
      scrollToSection();

      // Category 或 Model 变化时更新 URL
      if (inputName === 'category' || inputName === 'model') {
        updateUrl();
      }

      $(document).trigger('filters:changed', {
        type: inputName,
        value: $(this).val(),
        checked: $(this).is(':checked'),
      });
    });

    // 清除所有
    $filters.on('click', '.js-clear-filters', function (e) {
      e.preventDefault();

      // 清除所有 checkbox
      $filters.find('input[type="checkbox"]').prop('checked', false);

      // 重置 radio 到 "All"
      $filters.find('[data-filter-section="category"] input[value="all"]').prop('checked', true);
      $filters.find('[data-filter-section="model"] input[value="all"]').prop('checked', true);

      filterProducts();
      updateCount();
      updateUrl();
      $(document).trigger('filters:cleared');
    });

    // 更新计数
    function updateCount() {
      var count = $filters.find('input[type="checkbox"]:checked').length;

      // 单选：如果不是 "all" 就算 1 个
      $filters.find('input[type="radio"]:checked').each(function () {
        if ($(this).val() !== 'all') {
          count++;
        }
      });

      // 更新桌面端
      $filters.find('.js-active-count').text(count);
      $filters.find('.js-clear-filters').toggle(count > 0);

      // 更新移动端
      $('.js-mobile-active-count').text(count);
      $('.js-mobile-clear-filters').toggle(count > 0);
    }

    // 移动端清除过滤器（使用命名空间防止重复注册）
    $(document)
      .off('click.mobileClear')
      .on('click.mobileClear', '.js-mobile-clear-filters', function (e) {
        e.preventDefault();

        // 清除所有 checkbox
        $filters.find('input[type="checkbox"]').prop('checked', false);

        // 重置 radio 到 "All"
        $filters.find('[data-filter-section="category"] input[value="all"]').prop('checked', true);
        $filters.find('[data-filter-section="model"] input[value="all"]').prop('checked', true);

        filterProducts();
        updateCount();
        updateUrl();
        $(document).trigger('filters:cleared');
      });

    // 获取当前状态（供外部使用）
    window.getFiltersState = function () {
      return getSelectedFilters();
    };

    // 初始化
    initFilters();
  } // 结束 if-else 防重复初始化
</script>
