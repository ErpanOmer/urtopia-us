<style>
    .subscribe-container {
        display: grid;
        max-width: 976px;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        border-radius: 10px;
        background-color: transparent;
    }
    
    .subscribe-container .subscribe {
        display: flex;
        flex-direction: column;
        padding: 12%;
        justify-content: center;
        background-color: #fff;
    }
    
    .subscribe-container .subscribe img {
        margin: 30px 0;
        max-width: 265px;
    }
    
    .subscribe-container .subscribe .u17Light {
        line-height: 24px;
        margin-bottom: 86px;
    }
    
    .subscribe-container .subscribe .email {
        box-sizing: border-box;
        display: flex;
        height: 47px;
        position: relative;
    }
    
    .subscribe-container .subscribe .email input {
        height: 100%;
        width: 100%;
        border-color: #0000004d;
        border-radius: 30px;
        color: #000;
        padding: 0 25px;
        font-size: 14px;
        position: relative;
        z-index: 1;
        overflow: hidden;
        box-sizing: border-box;
    }
  
    .subscribe-container .subscribe .email button {
      border: none;
  }
  
    .subscribe-container .subscribe .email input:focus-visible {
      border-color: #000;
    }
    
    .subscribe-container .subscribe .email .my-button {
        position: absolute;
        right: 0;
        z-index: 2;
        height: 100%;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
    
    .subscribe-container .subscribe .email input::placeholder {
        color: #aaa;
    }
    
    .subscribe-container .close {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 40px;
      color: #999;
      cursor: pointer;
      font-weight: 100;
      display: block;
      height: 40px;
      line-height: 40px;
      width: 40px;
      text-align: center;
    }
    
    @media (max-width: 767px) {
        .subscribe-container {
            grid-template-columns: 1fr;
        }
    
        .subscribe-container .subscribe {
            padding: 8%;
        }
    
        .subscribe-container .subscribe .u20Medium {
            font-size: 18px;
            line-height: 21px;
        }
    
        .subscribe-container .subscribe img {
            margin: 15px 0;
            max-width: 205px;
        }
    
        .subscribe-container .subscribe .u17Light {
            font-size: 15px;
            line-height: 21px;
            margin-bottom: 40px;
        }
    
        .subscribe-container .subscribe .email {
            height: 40px;   
        }
    
        .subscribe-container .subscribe .email input {
            font-size: 12px;
            padding: 0 15px;
        }
    
        .subscribe-container .close {
            color: #fff;
            top: 0.5%;
            right: 1%;
        }
    }
    </style>
  <script>
    class MyStorage {
      constructor(props) {
        this.props = props || {};
        this.source = this.props.source || window.localStorage;
        this.initrun();
      }
      initrun() {
        /*
         * set 存储方法
         * @ param {string} key 键
         * @ param {string} value 值，存储的值可能是数组/对象，不能直接存储，需要转换 json.stringify
         * @ param {string} expired 过期时间，以分钟为单位
         * @ 由@it·平头哥联盟-首席填坑官∙苏南 分享
         */
        const reg = new RegExp('__expires__');
        let data = this.source;
        let list = Object.keys(data);
        if (list.length > 0) {
          list.map((key, v) => {
            if (!reg.test(key)) {
              let now = Date.now();
              let expires = data[`${key}__expires__`] || Date.now() + 1;
              if (now >= expires) {
                this.remove(key);
              }
            }
            return key;
          });
        }
      }
  
      set(key, value, expired = 3) {
        /*
        * set 存储方法
        * @ param {string} key 键
        * @ param {string} value 值，
        * @ param {string} expired 过期时间，以分钟为单位，非必须
        * @ 由@it·平头哥联盟-首席填坑官∙苏南 分享
        */
        let source = this.source;
        source[key] = JSON.stringify(value);
        if (expired){
        source[`${key}__expires__`] = Date.now() + 1000 * 60 * 60 * 24 * expired
        };
        return value;
       }
  
      get(key) {
        /*
        * get 获取方法
        * @ param {string} key 键
        * @ param {string} expired 存储时为非必须字段，所以有可能取不到，默认为 date.now+1
        * @ 由@it·平头哥联盟-首席填坑官∙苏南 分享
        */
        const source = this.source,
        expired = source[`${key}__expires__`]||Date.now()+1;
        const now = Date.now();
        
        if ( now >= expired ) {
        this.remove(key);
        return;
        }
        const value = source[key] ? JSON.parse(source[key]) : source[key];
        return value;
       }
  
      remove(key) {
        const data = this.source,
        value = data[key];
        delete data[key];
        delete data[`${key}__expires__`];
        return value;
       }
    }
  
  
    const storage = new MyStorage()
  
    const subscribeHtml = `<div class="subscribe-container">
      <img class="mobileHide" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Urtopia_Photo_Sesh_14_of_14_2x_9ec4000c-c609-4829-b4a2-430a5b7aae63.jpg?v=1680259217" alt="">
      <img class="pcHide" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Urtopia_Photo_Sesh_9_of_14_2x_dc648c2b-067f-4357-bda8-d917f51fd883.jpg?v=1680259100" alt="">
      <div class="subscribe">
          <span class="u20Medium">Easter sale expires Apr. 18</span>
          <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Union_12_2x_f3408316-66ce-44c8-ad74-6ee638a54650.jpg?v=1681095007">
          <span class="u17Light">Subscribe for Easter exclusive coupon and Utopia stories</span>
          <form class="new-contact" action="/contact#ContactFooter" target="_blank" method="post" accept-charset="UTF-8">
          <div class="email">
                <input type="hidden" name="form_type" value="customer">
                <input type="hidden" name="utf8" value="✓">
                <input type="hidden" name="contact[tags]" value="newsletter">
                <input placeholder="Enter email here" type="email" name="contact[email]" required>
                <button class="my-button my-button-black" type="submit">Subscribe</button>
          </div>
        </form>
      </div>
      <span class="close" onclick="closeMiniDialog()">×</span>
  </div>`
  
  function showMiniDialog(html = '') {
    if (storage.get('emailDialogHideDay')) {
      return
    }
  
    $('body .mini-dialog').remove()
    setTimeout(() => {
      $("body").append(`<div class="mini-dialog" style="display: flex;">${html}</div>`)
  
      {% comment %} setTimeout(() => {
        $('body .mini-dialog > div').on('click', e => {
          e.stopPropagation();
          return false;
        })
      }, 100) {% endcomment %}
  
  
       setTimeout(() => {
          $('.subscribe-container form').on("submit", function (event) {
            const email = $('.subscribe-container form input[type="email"]').val()
            console.log('email', email)
          const formData = new FormData()
          formData.append('form_type', 'customer')
          formData.append('contact[tags]', 'newsletter')
          formData.append('contact[email]', email)
          formData.append('commit', '')
          console.log('formData', formData)
  
            let body = {
                module: "de-shopify-subscribe-email",
                trace_name: "subscribe-email",
                trace_type: "subscribe-email",
                extras: {
                  email
                }
            }
  
  
            fetch("https://api.newurtopia.com/third_part/traces", {
                method: "POST",
                body: JSON.stringify(body),
                headers: {
                    "Content-Type": "application/json",
                },
            })
  
            
          closeMiniDialog(14)
        
            event.preventDefault();
            return false;
        })
      }, 1000)
  
  
  
    })
  }
  
  function closeMiniDialog(day = 3) {
    // console.log(a === document.querySelector('body .mini-dialog'))
    $('body .mini-dialog').remove()
  
  
    storage.set('emailDialogHideDay', 'emailDialogHideDay', day)
  }
  
  setTimeout(showMiniDialog, 5000, subscribeHtml)
  </script>